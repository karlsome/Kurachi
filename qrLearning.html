<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>QRã‚³ãƒ¼ãƒ‰å­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ </title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes pulse-green {
      0%, 100% { background-color: rgba(34, 197, 94, 0.1); }
      50% { background-color: rgba(34, 197, 94, 0.3); }
    }
    
    @keyframes pulse-red {
      0%, 100% { background-color: rgba(239, 68, 68, 0.1); }
      50% { background-color: rgba(239, 68, 68, 0.3); }
    }
    
    .pulse-green {
      animation: pulse-green 1s infinite;
    }
    
    .pulse-red {
      animation: pulse-red 1s infinite;
    }
    
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    
    .modal-content {
      background: white;
      padding: 2rem;
      border-radius: 1rem;
      max-width: 500px;
      width: 90%;
      text-align: center;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    
    .qr-sample-item {
      border: 2px solid #e5e7eb;
      border-radius: 0.5rem;
      padding: 1rem;
      margin-bottom: 0.5rem;
      transition: all 0.2s;
    }
    
    .qr-sample-item.scanned {
      border-color: #10b981;
      background-color: #ecfdf5;
    }
    
    .qr-sample-item.active {
      border-color: #3b82f6;
      background-color: #eff6ff;
    }
    
    .progress-bar {
      height: 8px;
      background: #e5e7eb;
      border-radius: 4px;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #3b82f6, #10b981);
      transition: width 0.3s ease;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 text-lg">
  <!-- Audio elements -->
  <audio id="success-sound" src="src/success.mp3" preload="auto"></audio>
  <audio id="error-sound" src="src/alert.mp3" preload="auto"></audio>
  
  <!-- Authentication Modal -->
  <div id="authModal" class="modal-overlay">
    <div class="modal-content">
      <h2 class="text-2xl font-bold text-purple-600 mb-4">ğŸ” å­¦ç¿’ãƒ¢ãƒ¼ãƒ‰èªè¨¼</h2>
      <p class="mb-4">å­¦ç¿’ãƒ¢ãƒ¼ãƒ‰ã¯ç®¡ç†è€…ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã™ã€‚</p>
      <p class="text-sm text-gray-600 mb-6">ãƒ¦ãƒ¼ã‚¶ãƒ¼åã®QRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦ãã ã•ã„ã€‚</p>
      
      <div class="bg-blue-50 p-4 rounded-lg mb-4">
        <p class="text-sm font-medium text-blue-800">èªè¨¼å¾…æ©Ÿä¸­...</p>
        <p class="text-xs text-blue-600 mt-1">ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚¹ã‚­ãƒ£ãƒŠãƒ¼ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼åQRã‚’ã‚¹ã‚­ãƒ£ãƒ³</p>
      </div>
      
      <button onclick="cancelAuth()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg">
        ã‚­ãƒ£ãƒ³ã‚»ãƒ«
      </button>
    </div>
  </div>
  
  <!-- Conflict Warning Modal -->
  <div id="conflictModal" class="modal-overlay" style="display:none;">
    <div class="modal-content">
      <h2 class="text-2xl font-bold text-red-600 mb-4">âš ï¸ ãƒ‘ã‚¿ãƒ¼ãƒ³ç«¶åˆæ¤œå‡º</h2>
      <div id="conflictMessage" class="mb-4 text-left bg-red-50 p-4 rounded-lg"></div>
      <p class="text-gray-600 mb-6">åŒã˜ãŠå®¢æ§˜ã®æ­£ã—ã„ãƒ©ãƒ™ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ</p>
      <div class="flex gap-2">
        <button onclick="continueWithConflict()" class="flex-1 bg-orange-600 hover:bg-orange-700 text-white py-2 px-4 rounded-lg">
          ç¶šè¡Œ
        </button>
        <button onclick="retryLearning()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg">
          å†è©¦è¡Œ
        </button>
      </div>
    </div>
  </div>
  
  <!-- Test Results Modal -->
  <div id="testModal" class="modal-overlay" style="display:none;">
    <div class="modal-content">
      <h2 class="text-2xl font-bold text-green-600 mb-4">ğŸ§ª ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ†ã‚¹ãƒˆçµæœ</h2>
      <div id="testResults" class="mb-4 text-left bg-green-50 p-4 rounded-lg max-h-64 overflow-y-auto"></div>
      <div class="flex gap-2">
        <button onclick="deployPattern()" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg">
          å…¨ãƒ‡ãƒã‚¤ã‚¹ã«é…ä¿¡
        </button>
        <button onclick="closeTestModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg">
          ã‚­ãƒ£ãƒ³ã‚»ãƒ«
        </button>
      </div>
    </div>
  </div>

  <div class="max-w-4xl mx-auto">
    <!-- Header -->
    <div class="bg-white rounded-2xl shadow-xl p-6 mb-6">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-3xl font-bold text-gray-800">QRã‚³ãƒ¼ãƒ‰å­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ </h1>
          <p class="text-gray-600 mt-2">æ–°ã—ã„ãŠå®¢æ§˜ã®QRãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å­¦ç¿’ã—ã¾ã™</p>
        </div>
        <button onclick="goBack()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-xl">
          æˆ»ã‚‹
        </button>
      </div>
    </div>

    <!-- Learning Progress -->
    <div class="bg-white rounded-2xl shadow-xl p-6 mb-6">
      <h2 class="text-xl font-bold text-gray-800 mb-4">å­¦ç¿’é€²æ—</h2>
      <div class="progress-bar mb-2">
        <div id="progressFill" class="progress-fill" style="width: 0%"></div>
      </div>
      <p id="progressText" class="text-sm text-gray-600">å¾…æ©Ÿä¸­...</p>
    </div>

    <!-- Customer Selection -->
    <div class="bg-white rounded-2xl shadow-xl p-6 mb-6">
      <h2 class="text-xl font-bold text-gray-800 mb-4">ãŠå®¢æ§˜é¸æŠ</h2>
      <select id="learningCustomerSelect" class="w-full p-3 border rounded-lg bg-white text-lg font-medium">
        <option value="">ãŠå®¢æ§˜ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
        <option value="tn">ãƒ†ã‚£ãƒ¼ã‚¨ãƒŒè£½ä½œæ‰€</option>
        <option value="toyota">ãƒˆãƒ¨ã‚¿ç´¡ç¹”</option>
        <option value="kinuura">è¡£æµ¦</option>
      </select>
    </div>

    <!-- Paired Learning Section -->
    <div class="bg-white rounded-2xl shadow-xl p-6 mb-6">
      <h2 class="text-xl font-bold text-gray-800 mb-4">ãƒšã‚¢å­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ </h2>
      <p class="text-sm text-gray-600 mb-4">ãŠå®¢æ§˜QR â†’ ç¤¾å†…QRã®é †ç•ªã§ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦å¯¾å¿œé–¢ä¿‚ã‚’å­¦ç¿’ã—ã¾ã™</p>
      
      <!-- Current Scan Status -->
      <div id="scanStatus" class="mb-6 p-4 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300">
        <div class="text-center">
          <div id="scanInstruction" class="text-lg font-medium text-gray-600 mb-2">
            ãŠå®¢æ§˜ã‚’é¸æŠã—ã¦ã‚¹ã‚­ãƒ£ãƒ³ã‚’é–‹å§‹ã—ã¦ãã ã•ã„
          </div>
          <div id="scanDetails" class="text-sm text-gray-500">
            ãŠå®¢æ§˜QRã‚’ã‚¹ã‚­ãƒ£ãƒ³ â†’ å¯¾å¿œã™ã‚‹ç¤¾å†…QRã‚’ã‚¹ã‚­ãƒ£ãƒ³
          </div>
        </div>
      </div>
      
      <!-- Action Buttons -->
      <div class="flex gap-2 mb-6">
        <button id="startCorrectPairs" onclick="startCorrectPairs()" 
          class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-xl" disabled>
          æ­£ã—ã„ãƒšã‚¢åé›†é–‹å§‹
        </button>
        <button id="startMismatchPairs" onclick="startMismatchPairs()" 
          class="flex-1 bg-red-600 hover:bg-red-700 text-white py-3 px-4 rounded-xl" disabled>
          ä¸ä¸€è‡´ãƒšã‚¢åé›†é–‹å§‹
        </button>
        <button id="finishLearning" onclick="finishLearning()" 
          class="flex-1 bg-green-600 hover:bg-green-700 text-white py-3 px-4 rounded-xl" disabled>
          å­¦ç¿’å®Œäº†
        </button>
      </div>
    </div>

    <!-- Learned Pairs Display -->
    <div class="bg-white rounded-2xl shadow-xl p-6 mb-6">
      <h2 class="text-xl font-bold text-gray-800 mb-4">å­¦ç¿’æ¸ˆã¿ãƒšã‚¢</h2>
      <div id="pairedSamples" class="space-y-3 max-h-64 overflow-y-auto">
        <p class="text-gray-500 text-center py-4">ãƒšã‚¢å­¦ç¿’ã‚’é–‹å§‹ã—ã¦ãã ã•ã„</p>
      </div>
      
      <!-- Statistics -->
      <div class="flex justify-between items-center mt-4 pt-4 border-t">
        <div class="text-sm text-gray-600">
          <span id="pairCount">0</span> æ­£ã—ã„ãƒšã‚¢ | 
          <span id="mismatchCount">0</span> ä¸ä¸€è‡´
        </div>
        <button onclick="clearAllPairs()" class="text-red-600 hover:text-red-800 text-sm">
          å…¨ãƒšã‚¢ã‚¯ãƒªã‚¢
        </button>
      </div>
    </div>

    <!-- Learning Controls -->
    <div class="bg-white rounded-2xl shadow-xl p-6 mb-6">
      <h2 class="text-xl font-bold text-gray-800 mb-4">å­¦ç¿’åˆ¶å¾¡</h2>
      <div class="grid md:grid-cols-4 gap-4">
        <button id="analyzePatterns" onclick="analyzePatterns()" 
          class="bg-purple-600 hover:bg-purple-700 text-white py-3 px-4 rounded-xl" disabled>
          ãƒ‘ã‚¿ãƒ¼ãƒ³è§£æé–‹å§‹
        </button>
        <button id="testPattern" onclick="testPattern()" 
          class="bg-yellow-600 hover:bg-yellow-700 text-white py-3 px-4 rounded-xl" disabled>
          ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ†ã‚¹ãƒˆ
        </button>
        <button id="clearLearning" onclick="clearLearning()" 
          class="bg-gray-500 hover:bg-gray-600 text-white py-3 px-4 rounded-xl">
          å…¨ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢
        </button>
        <button id="deleteCustomerData" onclick="deleteCustomerData()" 
          class="bg-red-600 hover:bg-red-700 text-white py-3 px-4 rounded-xl">
          å­¦ç¿’ãƒ‡ãƒ¼ã‚¿å‰Šé™¤
        </button>
      </div>
    </div>

    <!-- Learning Log -->
    <div class="bg-white rounded-2xl shadow-xl p-6">
      <h2 class="text-xl font-bold text-gray-800 mb-4">å­¦ç¿’ãƒ­ã‚°</h2>
      <div id="learningLog" class="bg-gray-50 p-4 rounded-lg h-64 overflow-y-auto text-sm">
        <p class="text-gray-500">å­¦ç¿’ãƒ­ã‚°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...</p>
      </div>
    </div>
  </div>

  <script src="qrLearning.js"></script>
</body>
</html>