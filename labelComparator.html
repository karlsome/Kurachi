
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>QR„Ç≥„Éº„ÉâÊØîËºÉ„ÉÑ„Éº„É´</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* Tailwind CSS Base Styles - Inlined for Offline Support */
    *, ::before, ::after { box-sizing: border-box; border-width: 0; border-style: solid; border-color: #e5e7eb; }
    ::before, ::after { --tw-content: ''; }
    html { line-height: 1.5; -webkit-text-size-adjust: 100%; -moz-tab-size: 4; tab-size: 4; font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; font-feature-settings: normal; font-variation-settings: normal; }
    body { margin: 0; line-height: inherit; }
    h1, h2, p, ul { margin: 0; }
    h1, h2 { font-size: inherit; font-weight: inherit; }
    button, input, select, textarea { font-family: inherit; font-size: 100%; font-weight: inherit; line-height: inherit; color: inherit; margin: 0; padding: 0; }
    button, select { text-transform: none; }
    button, [type='button'] { -webkit-appearance: button; appearance: button; background-color: transparent; background-image: none; }
    ul { list-style: none; padding: 0; }
    textarea { resize: vertical; }
    ::placeholder { opacity: 1; color: #9ca3af; }
    audio { display: inline-block; vertical-align: baseline; }
    [hidden] { display: none; }
    
    /* Tailwind Utilities - Inlined */
    .bg-gray-100 { background-color: #f3f4f6; }
    .bg-gray-50 { background-color: #f9fafb; }
    .bg-white { background-color: #ffffff; }
    .bg-blue-50 { background-color: #eff6ff; }
    .bg-blue-600 { background-color: #2563eb; }
    .bg-gray-500 { background-color: #6b7280; }
    .bg-purple-600 { background-color: #9333ea; }
    .bg-red-600 { background-color: #dc2626; }
    .hover\:bg-blue-700:hover { background-color: #1d4ed8; }
    .hover\:bg-gray-600:hover { background-color: #4b5563; }
    .hover\:bg-purple-700:hover { background-color: #7e22ce; }
    .border { border-width: 1px; }
    .border-gray-300 { border-color: #d1d5db; }
    .rounded-lg { border-radius: 0.5rem; }
    .rounded-xl { border-radius: 0.75rem; }
    .rounded-2xl { border-radius: 1rem; }
    .flex { display: flex; }
    .items-center { align-items: center; }
    .justify-center { justify-content: center; }
    .font-bold { font-weight: 700; }
    .font-semibold { font-weight: 600; }
    .font-medium { font-weight: 500; }
    .text-xs { font-size: 0.75rem; line-height: 1rem; }
    .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
    .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
    .text-xl { font-size: 1.25rem; line-height: 1.75rem; }
    .text-2xl { font-size: 1.5rem; line-height: 2rem; }
    .text-3xl { font-size: 1.875rem; line-height: 2.25rem; }
    .gap-2 { gap: 0.5rem; }
    .min-h-screen { min-height: 100vh; }
    .max-h-64 { max-height: 16rem; }
    .max-w-2xl { max-width: 42rem; }
    .w-full { width: 100%; }
    .mb-2 { margin-bottom: 0.5rem; }
    .mb-4 { margin-bottom: 1rem; }
    .mb-6 { margin-bottom: 1.5rem; }
    .mt-1 { margin-top: 0.25rem; }
    .mt-4 { margin-top: 1rem; }
    .mt-6 { margin-top: 1.5rem; }
    .my-6 { margin-top: 1.5rem; margin-bottom: 1.5rem; }
    .overflow-y-auto { overflow-y: auto; }
    .p-2 { padding: 0.5rem; }
    .p-3 { padding: 0.75rem; }
    .p-4 { padding: 1rem; }
    .p-8 { padding: 2rem; }
    .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
    .shadow-xl { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1); }
    .space-y-2 > :not([hidden]) ~ :not([hidden]) { margin-top: 0.5rem; }
    .space-y-3 > :not([hidden]) ~ :not([hidden]) { margin-top: 0.75rem; }
    .text-center { text-align: center; }
    .text-blue-600 { color: #2563eb; }
    .text-gray-500 { color: #6b7280; }
    .text-gray-600 { color: #4b5563; }
    .text-gray-700 { color: #374151; }
    .text-gray-800 { color: #1f2937; }
    .text-green-600 { color: #16a34a; }
    .text-red-600 { color: #dc2626; }
    .text-white { color: #ffffff; }
    .transition { transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 150ms; }
    .duration-200 { transition-duration: 200ms; }
    .block { display: block; }
    .resize-none { resize: none; }
    
    /* Custom Styles */
    @keyframes flash-red {
      0%, 100% { background-color: rgba(255, 0, 0, 0.1); }
      50% { background-color: rgba(255, 0, 0, 0.8); }
    }
    
    .flash-red {
      animation: flash-red 0.7s infinite;
    }
    
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    
    .modal-content {
      background: white;
      padding: 2rem;
      border-radius: 1rem;
      max-width: 550px;
      width: 90%;
      max-height: 95vh;
      text-align: center;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      display: flex;
      flex-direction: column;
      box-sizing: border-box;
    }
    
    @media (max-height: 800px) {
      .modal-content {
        padding: 1.5rem;
      }
      .modal-content h2 {
        font-size: 1.75rem;
        margin-bottom: 0.75rem;
      }
      .modal-content p {
        font-size: 0.95rem;
        margin-bottom: 0.75rem;
      }
    }
    
    @media (max-height: 700px) {
      .modal-content {
        padding: 1.25rem;
      }
      .modal-content h2 {
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
      }
      .modal-content p {
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
      }
      .instruction-step {
        margin-bottom: 0.4rem;
        padding: 0.3rem;
        font-size: 0.85rem;
      }
      .modal-button {
        padding: 0.5rem 1.5rem;
        font-size: 0.9rem;
        margin-top: 0.75rem;
      }
      .space-y-3 {
        gap: 0.4rem;
      }
    }
    
    @media (max-height: 600px) {
      .modal-content {
        padding: 1rem;
      }
      .modal-content h2 {
        font-size: 1.25rem;
        margin-bottom: 0.4rem;
      }
      .modal-content p {
        font-size: 0.8rem;
        margin-bottom: 0.4rem;
      }
      .instruction-step {
        margin-bottom: 0.3rem;
        padding: 0.25rem;
        font-size: 0.75rem;
      }
      .modal-button {
        padding: 0.4rem 1.25rem;
        font-size: 0.85rem;
        margin-top: 0.5rem;
      }
    }
    
    @media (max-height: 500px) {
      .modal-content {
        padding: 0.75rem;
      }
      .modal-content h2 {
        font-size: 1.1rem;
        margin-bottom: 0.3rem;
      }
      .modal-content p {
        font-size: 0.7rem;
        margin-bottom: 0.3rem;
      }
      .instruction-step {
        margin-bottom: 0.2rem;
        padding: 0.2rem;
        font-size: 0.65rem;
      }
      .instruction-step .step-number {
        width: 1.2rem;
        height: 1.2rem;
        font-size: 0.7rem;
      }
      .modal-button {
        padding: 0.35rem 1rem;
        font-size: 0.75rem;
        margin-top: 0.4rem;
      }
    }
    
    @media (max-height: 400px) {
      .modal-content {
        padding: 0.5rem;
      }
      .modal-content h2 {
        font-size: 1rem;
        margin-bottom: 0.25rem;
      }
      .modal-content p {
        font-size: 0.65rem;
        margin-bottom: 0.25rem;
      }
      .instruction-step {
        margin-bottom: 0.15rem;
        padding: 0.15rem;
        font-size: 0.6rem;
      }
      .instruction-step .step-number {
        width: 1rem;
        height: 1rem;
        font-size: 0.6rem;
        margin-right: 0.3rem;
      }
      .modal-button {
        padding: 0.3rem 0.75rem;
        font-size: 0.7rem;
        margin-top: 0.3rem;
      }
    }
    
    .mismatch-modal .modal-content {
      border-left: 8px solid #ef4444;
    }
    
    .welcome-modal .modal-content {
      border-left: 8px solid #3b82f6;
    }
    
    .modal-button {
      border: none;
      padding: 0.75rem 2rem;
      border-radius: 0.5rem;
      font-weight: bold;
      margin-top: 1rem;
      cursor: pointer;
      transition: background-color 0.2s;
      color: white;
    }
    
    .modal-button.red {
      background: #ef4444;
    }
    
    .modal-button.red:hover {
      background: #dc2626;
    }
    
    .modal-button.blue {
      background: #3b82f6;
    }
    
    .modal-button.blue:hover {
      background: #2563eb;
    }
    
    .instruction-step {
      text-align: left;
      margin-bottom: 1rem;
      padding: 0.5rem;
      border-radius: 0.5rem;
      background: #f3f4f6;
    }
    
    .instruction-step .step-number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 1.5rem;
      height: 1.5rem;
      background: #3b82f6;
      color: white;
      border-radius: 50%;
      margin-right: 0.5rem;
      font-weight: bold;
      font-size: 0.875rem;
    }
    
    /* Custom Dropdown Styles for Offline Support */
    .custom-dropdown {
      position: relative;
      width: 100%;
    }
    
    .custom-dropdown-button {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #d1d5db;
      border-radius: 0.5rem;
      background: white;
      text-align: left;
      font-size: 1.125rem;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.2s;
    }
    
    .custom-dropdown-button:hover {
      border-color: #3b82f6;
      background: #f9fafb;
    }
    
    .custom-dropdown-button:active {
      background: #f3f4f6;
    }
    
    .custom-dropdown-arrow {
      transition: transform 0.2s;
      font-size: 0.75rem;
    }
    
    .custom-dropdown.open .custom-dropdown-arrow {
      transform: rotate(180deg);
    }
    
    .custom-dropdown-menu {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      margin-top: 0.25rem;
      background: white;
      border: 1px solid #d1d5db;
      border-radius: 0.5rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      z-index: 100;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-out;
    }
    
    .custom-dropdown.open .custom-dropdown-menu {
      max-height: 300px;
      overflow-y: auto;
    }
    
    .custom-dropdown-option {
      padding: 0.75rem;
      cursor: pointer;
      font-size: 1.125rem;
      font-weight: 500;
      transition: background 0.15s;
      border-bottom: 1px solid #f3f4f6;
    }
    
    .custom-dropdown-option:last-child {
      border-bottom: none;
    }
    
    .custom-dropdown-option:hover {
      background: #eff6ff;
    }
    
    .custom-dropdown-option:active {
      background: #dbeafe;
    }
    
    .custom-dropdown-option.selected {
      background: #3b82f6;
      color: white;
      font-weight: 600;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4 text-lg">
  <!-- Audio element for alert sound -->
  <audio id="alert-sound" src="src/alert.mp3" preload="auto"></audio>
  <!-- Audio element for success sound -->
  <audio id="success-sound" src="src/success.mp3" preload="auto"></audio>
  
  <!-- Welcome Modal -->
  <div id="welcomeModal" class="modal-overlay welcome-modal">
    <div class="modal-content">
      <h2 class="text-2xl font-bold text-blue-600 mb-4">QR„Ç≥„Éº„ÉâÊØîËºÉ„ÉÑ„Éº„É´„Å∏„Çà„ÅÜ„Åì„Åù</h2>
      
      <div class="space-y-3 my-6">
        <div class="instruction-step">
          <span class="step-number">1</span>
          <span>„Éê„Éº„Ç≥„Éº„Éâ„Çπ„Ç≠„É£„Éä„Éº„Åß„ÅäÂÆ¢ÊßòQR„Ç≥„Éº„Éâ„Çí„Çπ„Ç≠„É£„É≥„Åó„Åæ„Åô</span>
        </div>
        <div class="instruction-step">
          <span class="step-number">2</span>
          <span>Á∂ö„ÅÑ„Å¶„ÄÅÁ§æÂÜÖQR„Ç≥„Éº„Éâ„Çí„Çπ„Ç≠„É£„É≥„Åó„Åæ„Åô</span>
        </div>
        <div class="instruction-step">
          <span class="step-number">3</span>
          <span>‰∏°Êñπ„Çπ„Ç≠„É£„É≥„Åô„Çã„Å®Ëá™ÂãïÁöÑ„Å´ÊØîËºÉ„Åó„Åæ„Åô</span>
        </div>
        <div class="instruction-step">
          <span class="step-number">4</span>
          <span>‰∏ç‰∏ÄËá¥„ÅÆÂ†¥Âêà„ÅØË≠¶ÂëäÈü≥„Å®ÁîªÈù¢Ë°®Á§∫„Åß„ÅäÁü•„Çâ„Åõ„Åó„Åæ„Åô</span>
        </div>
      </div>
      
      <p class="text-sm text-gray-600 mb-4">„Äå„Çπ„Ç≠„É£„É≥ÈñãÂßã„Äç„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„ÄÅ„Çπ„Ç≠„É£„É≥„ÇíÈñãÂßã„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
      <button id="startButton" class="modal-button blue">„Çπ„Ç≠„É£„É≥ÈñãÂßã</button>
    </div>
  </div>
  
  <!-- Mismatch Alert Modal -->
  <div id="mismatchModal" class="modal-overlay mismatch-modal" style="display:none;">
    <div class="modal-content">
      <h2 class="text-2xl font-bold text-red-600 mb-4">‚ö†Ô∏è QR„Ç≥„Éº„Éâ‰∏ç‰∏ÄËá¥</h2>
      <p id="mismatchMessage" class="mb-4 text-lg"></p>
      <p class="text-gray-600 mb-6">Á¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇQR„Ç≥„Éº„Éâ„ÅåÁï∞„Å™„Çä„Åæ„Åô„ÄÇ</p>
      <button class="modal-button red" onclick="closeMismatchModal()">Á¢∫Ë™ç</button>
    </div>
  </div>
  
  <div class="bg-white rounded-2xl shadow-xl p-8 max-w-2xl w-full">
    <h1 class="text-3xl font-bold text-center text-gray-800 mb-4">QR„Ç≥„Éº„ÉâÊØîËºÉ</h1>
    
    <!-- Customer Selection Dropdown -->
    <div class="mb-6">
      <label class="block text-sm font-semibold text-gray-600 mb-2">„ÅäÂÆ¢ÊßòÈÅ∏Êäû</label>
      <div class="custom-dropdown" id="customerDropdown">
        <button type="button" class="custom-dropdown-button" id="customerDropdownButton">
          <span id="customerDropdownSelected">„ÉÜ„Ç£„Éº„Ç®„ÉåË£Ω‰ΩúÊâÄ</span>
          <span class="custom-dropdown-arrow">‚ñº</span>
        </button>
        <div class="custom-dropdown-menu" id="customerDropdownMenu">
          <div class="custom-dropdown-option selected" data-value="tn">„ÉÜ„Ç£„Éº„Ç®„ÉåË£Ω‰ΩúÊâÄ</div>
          <div class="custom-dropdown-option" data-value="toyota">„Éà„É®„ÇøÁ¥°Áπî</div>
          <div class="custom-dropdown-option" data-value="kinuura">Ë°£Êµ¶</div>
        </div>
      </div>
      <!-- Hidden input to maintain compatibility with existing JS -->
      <input type="hidden" id="customerSelect" value="tn">
    </div>
    
    <!-- Online/Offline Status Indicator -->
    <div id="onlineStatus" class="text-center text-xs font-medium mb-2 p-2 rounded-lg">
      <span id="onlineStatusText"></span>
    </div>
    
    <!-- Scan Status -->
    <div id="scanStatus" class="text-center text-sm font-medium text-blue-600 mb-6 p-2 bg-blue-50 rounded-lg">
      „Çπ„Ç≠„É£„É≥ÂæÖÊ©ü‰∏≠...
    </div>

    <div class="mb-4">
      <label for="customerQR" class="block text-sm font-semibold text-gray-600">„ÅäÂÆ¢ÊßòQR</label>
      <textarea id="customerQR" rows="2" placeholder="„ÅäÂÆ¢Êßò„ÅÆQR„Ç≥„Éº„Éâ„Åå„Åì„Åì„Å´Ëá™ÂãïË°®Á§∫„Åï„Çå„Åæ„Åô"
        class="mt-1 p-3 w-full border rounded-lg bg-gray-50 resize-none" readonly></textarea>
    </div>

    <div class="mb-4">
      <label for="ourQR" class="block text-sm font-semibold text-gray-600">ÂºäÁ§æQR</label>
      <textarea id="ourQR" rows="2" placeholder="ÂºäÁ§æ„ÅÆQR„Ç≥„Éº„Éâ„Åå„Åì„Åì„Å´Ëá™ÂãïË°®Á§∫„Åï„Çå„Åæ„Åô"
        class="mt-1 p-3 w-full border rounded-lg bg-gray-50 resize-none" readonly></textarea>
    </div>

    <div class="flex gap-2 mb-4">
      <button onclick="compareQRs()"
        class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-xl transition duration-200">
        ÊâãÂãïÊØîËºÉ
      </button>
      <button onclick="clearFields()"
        class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-semibold py-3 rounded-xl transition duration-200">
        „ÇØ„É™„Ç¢
      </button>
      <button id="learningModeBtn" onclick="openLearningMode()"
        class="flex-1 bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 rounded-xl transition duration-200">
        Â≠¶Áøí„É¢„Éº„Éâ
      </button>
    </div>

    <div id="result" class="mt-4 text-center text-lg font-semibold"></div>

    <div class="mt-6">
      <h2 class="text-lg font-medium text-gray-500 mb-2">„Çπ„Ç≠„É£„É≥„É≠„Ç∞:</h2>
      <ul id="logList" class="max-h-64 overflow-y-auto text-sm text-gray-700 space-y-2 bg-gray-50 p-4 rounded-lg border"></ul>
    </div>
  </div>

  <script>
    // Audio System with Offline Fallback
    (function() {
      const AudioSystem = {
        online: navigator.onLine,
        audioContext: null,
        
        init: function() {
          // Update online status
          window.addEventListener('online', () => {
            this.online = true;
            console.log('Audio: Online mode - using MP3 files');
          });
          
          window.addEventListener('offline', () => {
            this.online = false;
            console.log('Audio: Offline mode - using generated tones');
          });
          
          // Initialize Web Audio API for offline sounds
          try {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            this.audioContext = new AudioContext();
          } catch (e) {
            console.error('Web Audio API not supported:', e);
          }
        },
        
        playSuccess: function() {
          if (this.online) {
            // Try to play MP3 file
            const audio = document.getElementById('success-sound');
            if (audio) {
              audio.muted = false;
              audio.volume = 1.0;
              audio.currentTime = 0;
              audio.play().catch(err => {
                console.log('MP3 playback failed, using fallback tone');
                this.playSuccessTone();
              });
            } else {
              this.playSuccessTone();
            }
          } else {
            // Use generated tone for offline
            this.playSuccessTone();
          }
        },
        
        playError: function() {
          if (this.online) {
            // Try to play MP3 file
            const audio = document.getElementById('alert-sound');
            if (audio) {
              audio.muted = false;
              audio.volume = 0.3;
              audio.currentTime = 0;
              audio.play().catch(err => {
                console.log('MP3 playback failed, using fallback tone');
                this.playErrorTone();
              });
            } else {
              this.playErrorTone();
            }
          } else {
            // Use generated tone for offline
            this.playErrorTone();
          }
        },
        
        playSuccessTone: function() {
          if (!this.audioContext) return;
          
          const ctx = this.audioContext;
          const now = ctx.currentTime;
          
          // Create pleasant success sound: two ascending tones
          // First tone: C (523.25 Hz)
          const osc1 = ctx.createOscillator();
          const gain1 = ctx.createGain();
          osc1.connect(gain1);
          gain1.connect(ctx.destination);
          
          osc1.type = 'sine';
          osc1.frequency.value = 523.25;
          gain1.gain.setValueAtTime(0, now);
          gain1.gain.linearRampToValueAtTime(0.3, now + 0.01);
          gain1.gain.linearRampToValueAtTime(0, now + 0.15);
          
          osc1.start(now);
          osc1.stop(now + 0.15);
          
          // Second tone: E (659.25 Hz) - slightly delayed
          const osc2 = ctx.createOscillator();
          const gain2 = ctx.createGain();
          osc2.connect(gain2);
          gain2.connect(ctx.destination);
          
          osc2.type = 'sine';
          osc2.frequency.value = 659.25;
          gain2.gain.setValueAtTime(0, now + 0.1);
          gain2.gain.linearRampToValueAtTime(0.3, now + 0.11);
          gain2.gain.linearRampToValueAtTime(0, now + 0.3);
          
          osc2.start(now + 0.1);
          osc2.stop(now + 0.3);
        },
        
        playErrorTone: function() {
          if (!this.audioContext) return;
          
          const ctx = this.audioContext;
          const now = ctx.currentTime;
          
          // Create alarming error sound: three buzzer-like pulses
          for (let i = 0; i < 3; i++) {
            const startTime = now + (i * 0.25);
            
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);
            
            osc.type = 'sawtooth'; // Harsher sound for error
            osc.frequency.value = 200; // Low frequency for alert
            
            gain.gain.setValueAtTime(0, startTime);
            gain.gain.linearRampToValueAtTime(0.2, startTime + 0.01);
            gain.gain.linearRampToValueAtTime(0, startTime + 0.15);
            
            osc.start(startTime);
            osc.stop(startTime + 0.15);
          }
        }
      };
      
      // Initialize audio system
      AudioSystem.init();
      
      // Make it globally available
      window.AudioSystem = AudioSystem;
    })();
    
    // Custom Dropdown Logic for Offline Support
    (function() {
      const dropdown = document.getElementById('customerDropdown');
      const button = document.getElementById('customerDropdownButton');
      const menu = document.getElementById('customerDropdownMenu');
      const selectedText = document.getElementById('customerDropdownSelected');
      const hiddenInput = document.getElementById('customerSelect');
      const options = menu.querySelectorAll('.custom-dropdown-option');
      
      // Toggle dropdown
      button.addEventListener('click', function(e) {
        e.stopPropagation();
        dropdown.classList.toggle('open');
      });
      
      // Close dropdown when clicking outside
      document.addEventListener('click', function() {
        dropdown.classList.remove('open');
      });
      
      // Prevent closing when clicking inside menu
      menu.addEventListener('click', function(e) {
        e.stopPropagation();
      });
      
      // Handle option selection
      options.forEach(function(option) {
        option.addEventListener('click', function() {
          const value = this.getAttribute('data-value');
          const text = this.textContent;
          
          // Update selected text
          selectedText.textContent = text;
          
          // Update hidden input
          hiddenInput.value = value;
          
          // Update selected class
          options.forEach(function(opt) {
            opt.classList.remove('selected');
          });
          this.classList.add('selected');
          
          // Close dropdown
          dropdown.classList.remove('open');
          
          // Trigger change event for compatibility with existing code
          const event = new Event('change', { bubbles: true });
          hiddenInput.dispatchEvent(event);
          
          // Save to form data (matching existing functionality)
          if (typeof saveFormData === 'function') {
            const customerQR = document.getElementById('customerQR');
            const ourQR = document.getElementById('ourQR');
            saveFormData({
              customerQR: customerQR ? customerQR.value : '',
              ourQR: ourQR ? ourQR.value : '',
              customerType: value
            });
          }
          
          console.log('Customer type changed to:', value);
        });
      });
      
      // Restore saved customer type on page load
      window.addEventListener('DOMContentLoaded', function() {
        setTimeout(function() {
          if (typeof loadFormData === 'function') {
            const savedFormData = loadFormData();
            if (savedFormData.customerType) {
              const savedOption = menu.querySelector('[data-value="' + savedFormData.customerType + '"]');
              if (savedOption) {
                savedOption.click();
              }
            }
          }
        }, 100);
      });
    })();
    
    // Offline Mode Handler
    (function() {
      const learningModeBtn = document.getElementById('learningModeBtn');
      const onlineStatus = document.getElementById('onlineStatus');
      const onlineStatusText = document.getElementById('onlineStatusText');
      
      function updateOfflineUI() {
        const isOnline = navigator.onLine;
        
        // Update learning mode button
        if (learningModeBtn) {
          if (isOnline) {
            learningModeBtn.disabled = false;
            learningModeBtn.style.opacity = '1';
            learningModeBtn.style.cursor = 'pointer';
            learningModeBtn.title = '';
          } else {
            learningModeBtn.disabled = true;
            learningModeBtn.style.opacity = '0.5';
            learningModeBtn.style.cursor = 'not-allowed';
            learningModeBtn.title = '„Ç™„Éï„É©„Ç§„É≥„Åß„ÅØ‰ΩøÁî®„Åß„Åç„Åæ„Åõ„Çì';
          }
        }
        
        // Update online/offline status indicator
        if (onlineStatus && onlineStatusText) {
          if (isOnline) {
            onlineStatus.style.backgroundColor = '#d1fae5';
            onlineStatus.style.color = '#065f46';
            onlineStatusText.textContent = 'üü¢ „Ç™„É≥„É©„Ç§„É≥ („Éá„Éº„Çø„Éô„Éº„ÇπÂêåÊúü‰∏≠)';
          } else {
            onlineStatus.style.backgroundColor = '#fee2e2';
            onlineStatus.style.color = '#991b1b';
            onlineStatusText.textContent = 'üî¥ „Ç™„Éï„É©„Ç§„É≥ („É≠„Éº„Ç´„É´„É¢„Éº„Éâ - „Éá„Éº„Çø„ÅØÂæå„ÅßÂêåÊúü„Åï„Çå„Åæ„Åô)';
          }
        }
      }
      
      // Update UI on load
      updateOfflineUI();
      
      // Update UI when online/offline status changes
      window.addEventListener('online', updateOfflineUI);
      window.addEventListener('offline', updateOfflineUI);
      
      // Override openLearningMode function
      window.openLearningMode = function() {
        if (!navigator.onLine) {
          alert('Â≠¶Áøí„É¢„Éº„Éâ„ÅØ„Ç™„É≥„É©„Ç§„É≥ÊôÇ„ÅÆ„Åø‰ΩøÁî®„Åß„Åç„Åæ„Åô„ÄÇ');
          return;
        }
        window.location.href = 'qrLearning.html';
      };
    })();
  </script>
  <script src="qrPatternCache.js"></script>
  <script src="labelComparator.js"></script>
</body>
</html>



